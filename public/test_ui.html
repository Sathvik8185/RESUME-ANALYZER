<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Resume Analyzer Test</title>
    <style>
        body { font-family: sans-serif; padding: 40px; max-width: 800px; margin: auto; background: #f4f4f4; }
        .container { background: white; padding: 30px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        textarea { width: 100%; height: 100px; margin-bottom: 15px; padding: 10px; border: 1px solid #ccc; }
        input[type="file"] { margin-bottom: 20px; }
        
        /* Green Button */
        #analyzeBtn { 
            background: #83a36e; color: white; padding: 12px 24px; 
            border: none; cursor: pointer; font-size: 16px; border-radius: 4px; 
            display: block; width: 100%;
        }
        #analyzeBtn:hover { background: #6f9577; }

        #result { margin-top: 20px; padding: 15px; background: #e9ecef; border-radius: 5px; display: none; }
        pre { white-space: pre-wrap; word-wrap: break-word; }
    </style>
</head>
<body>

    <div class="container">
        <h2>Backend Tester</h2>
        
        <label><strong>1. Paste Job Description:</strong></label>
        <textarea id="jd" placeholder="Paste JD here..."></textarea>

        <label><strong>2. Upload Resume (PDF):</strong></label>
        <br>
        <input type="file" id="resume">
        <br>

        <button type="button" id="analyzeBtn">Analyze Resume</button>

        <div id="result">
            <h3>Server Response:</h3>
            <pre id="output">Waiting...</pre>
        </div>
    </div>

    <script>
        // We attach the event listener here to have full control
        document.getElementById('analyzeBtn').addEventListener('click', function(event) {
            
            event.preventDefault(); 
            console.log("Button clicked! Starting analysis...");

            const jd = document.getElementById('jd').value;
            const fileInput = document.getElementById('resume');
            const output = document.getElementById('output');
            const resultDiv = document.getElementById('result');

            if (!jd) { alert("Please enter a Job Description"); return; }
            if (fileInput.files.length === 0) { alert("Please select a PDF file"); return; }

            const formData = new FormData();
            formData.append('jd_text', jd);
            formData.append('resume', fileInput.files[0]);

            // Show loading state
            resultDiv.style.display = 'block';
            output.innerText = "Sending to server... ";

            fetch('http://localhost:8000/api/analyze', {
                method: 'POST',
                body: formData
            })
            .then(response => response.text()) // Get text first to debug errors
            .then(text => {
                console.log("Raw Server Response:", text); // See exact output in Console
                try {
                    const data = JSON.parse(text); // Try to parse JSON
                    output.innerText = JSON.stringify(data, null, 4); // Pretty print
                } catch (e) {
                    output.innerText = "Error Parsing JSON:\n" + text;
                }
            })
            .catch(error => {
                console.error("Fetch Error:", error);
                output.innerText = "Network Error: " + error.message;
            });
        });
    </script>
</body>
</html>